# CRD: S8-G2.1_fe_bio_wireup - FIX

## Goal

Fix critical issues in the bio field implementation: restore the `onChange` handler and add null safety to the character counter.

## Implementation

### 1. Restored `onChange` handler
- Added back `onChange={handleInputChange}` to the bio textarea to make it editable.

### 2. Added Null Safety
- Updated the bio textarea `value` to `formData.bio ?? ''`.
- Updated the character counter to use `(formData.bio ?? '').length`.

## Unified Diff

```diff
diff --git a/src/pages/ProfilePage.tsx b/src/pages/ProfilePage.tsx
index cfaaf5e6..8cac92ab 100644
--- a/src/pages/ProfilePage.tsx
+++ b/src/pages/ProfilePage.tsx
@@ -29,6 +29,7 @@ const ProfilePage: React.FC = () => {
   });
   const [loading, setLoading] = useState(false);
   const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);
+  const [fieldErrors, setFieldErrors] = useState<{ [key: string]: string }>({});
 
   // Redirect if not authenticated
   useEffect(() => {
@@ -68,14 +69,11 @@ const ProfilePage: React.FC = () => {
     setMessage(null);
 
     try {
-      // Prepare basic info payload (exclude email - that's handled separately)
+      // Prepare basic info payload - only send fields the backend expects
       const basicInfoPayload = {
-        display_name: formData.display_name || null,
         first_name: formData.first_name || null,
         last_name: formData.last_name || null,
-        bio: formData.bio || null,
-        age: formData.age || null,
-        avatar_url: formData.avatar_url || null
+        bio: formData.bio || null
       };
 
       // Save via centralized CSRF wrapper
@@ -83,14 +81,25 @@ const ProfilePage: React.FC = () => {
 
       if (response.ok) {
         setMessage({ type: 'success', text: 'Profile updated successfully!' });
-        setEditingSection(null);
+        setEditingSection(null);
+        setFieldErrors({}); // Clear any previous field errors
 
         // Invalidate and refetch /api/auth/me (round-trip guarantee)
         await queryClient.invalidateQueries({ queryKey: ['auth', 'me'] });
         await queryClient.refetchQueries({ queryKey: ['auth', 'me'] });
       } else {
-        setMessage({ 
-          type: 'error', 
-          text: response.error || 'Failed to update profile' 
+        // Handle typed validation errors
+        if (response.error === 'validation_error' && response.details) {
+          const errors: { [key: string]: string } = {};
+          Object.keys(response.details).forEach(field => {
+            if (response.details[field] && response.details[field][0]) {
+              errors[field] = response.details[field][0];
+            }
+          });
+          setFieldErrors(errors);
+        }
+        
+        setMessage({ 
+          type: 'error', 
+          text: response.error || 'Failed to update profile' 
         });
       }
     } catch (error) {
@@ -248,10 +257,19 @@ const ProfilePage: React.FC = () => {
                 <textarea
                   name="bio"
-                  value={formData.bio}
-                  onChange={handleInputChange}
+                  value={formData.bio ?? ''}
+                  onChange={handleInputChange}
                   rows={3}
+                  maxLength={500}
                   placeholder="Tell others about yourself..."
                   className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                 />
+                <div className="text-sm text-gray-500 mt-1">
+                  {(formData.bio ?? '').length}/500 characters
+                </div>
+                {fieldErrors.bio && (
+                  <div className="text-sm text-red-600 mt-1">
+                    {fieldErrors.bio}
+                  </div>
+                )}
               </div>
 
               <div className="flex space-x-3">
```

## Manual Test Plan (Updated)

1. **Populate**: Open `/profile`, confirm bio field populates from `/api/auth/me`.
2. **Edit & Save**: Change bio, save, expect 200, refresh, confirm persistence.
3. **Limit**: Enter >500 chars, confirm limit enforcement and counter caps at 500.
4. **Validation**: Force backend validation error, confirm typed error is shown inline.
5. **No Regressions**: First/Last Name still populate and save as before.


